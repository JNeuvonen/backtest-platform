FROM python:3.9-slim

ARG DATABASE_URI
ENV DATABASE_URI=$DATABASE_URI
ENV SERVICE_PORT=8000
ENV AUTO_WHITELISTED_IP=87.94.138.211
ENV ENV=PROD

RUN if [ -z "$DATABASE_URI" ]; then echo "DATABASE_URI argument not provided" && exit 1; fi

WORKDIR /usr/src/app

COPY . .

RUN pip install -e projects/common_python

# Add the verification script and run it
COPY verify_install.py .

WORKDIR /usr/src/app

RUN pip install --no-cache-dir -r projects/prediction_server/requirements.txt
RUN python verify_install.py

EXPOSE 8000

WORKDIR /usr/src/app/projects/prediction_server/src
CMD ["python", "-m", "main"]
